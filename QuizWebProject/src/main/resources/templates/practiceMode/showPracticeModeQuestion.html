<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
  <meta charset="UTF-8">
  <title>Practice Question</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f7f9fc;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }

    .container {
      background-color: white;
      padding: 40px 60px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      text-align: left;
      width: 100%;
      max-width: 700px;
    }

    h2 {
      color: #2c3e50;
      text-align: center;
    }

    input[type="text"], select {
      width: 100%;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
      margin-top: 8px;
    }

    button {
      padding: 10px 20px;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 6px;
      font-weight: bold;
      margin-right: 10px;
      cursor: pointer;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    td, th {
      padding: 8px;
      border: 1px solid #ccc;
    }

    img {
      max-width: 100%;
      height: auto;
      margin-top: 10px;
    }
  </style>
</head>
<body>
<div class="container">
  <h2>Practice Mode</h2>

  <form id="quizForm" th:action="@{|/quiz/${quiz.id}/practiceMode/question/${index}/quickCheck|}" method="post">
    <div th:switch="${question.questionType}">

      <!-- TestQuestion -->
      <div th:case="'TestQuestion'">
        <p th:text="${question.question}"></p>
        <ul>
          <li th:each="opt : ${question.savAnswers}">
            <label>
              <input type="checkbox" class="answer-input" data-type="checkbox" th:value="${opt}" />
              <span th:text="${opt}"></span>
            </label>
          </li>
        </ul>
      </div>

      <!-- ResponseQuestion -->
      <div th:case="'ResponseQuestion'">
        <label>
          <span th:text="${question.question}"></span><br />
          <input type="text" class="answer-input" data-type="text" />
        </label>
      </div>

      <!-- FillBlankQuestion -->
      <div th:case="'FillBlankQuestion'">
        <label>
          <span th:text="${question.question}"></span><br />
          <input type="text" class="answer-input" data-type="text" />
        </label>
      </div>

      <!-- MatchingQuestion -->
      <div th:case="'MatchingQuestion'">
        <p th:text="${question.question}"></p>
        <table>
          <thead>
          <tr><th>Left</th><th>Match with</th></tr>
          </thead>
          <tbody>
          <tr th:each="leftItem, iterStat : ${question.leftItems}">
            <td th:text="${leftItem}"></td>
            <td>
              <select class="answer-input" data-type="select">
                <option value="">-- Select --</option>
                <option th:each="rightItem : ${question.rightItems}" th:value="${rightItem}" th:text="${rightItem}"></option>
              </select>
            </td>
          </tr>
          </tbody>
        </table>
      </div>

      <!-- PictureResponseQuestion -->
      <div th:case="'PictureResponseQuestion'">
        <p th:text="${question.question}"></p>
        <img th:src="${question.imageUrl}" alt="Image question"
             style="max-width: 100%; max-height: 300px;" onerror="this.style.display='none'" />
        <div>
          <a th:href="${question.imageUrl}" th:text="${question.imageUrl}" target="_blank">View image</a>
        </div>
        <label>
          <span>Your Answer:</span>
          <input type="text" class="answer-input" data-type="text" />
        </label>
      </div>

      <!-- AutoGeneratedQuestion -->
      <div th:case="'AutoGeneratedQuestion'">
        <p th:text="${question.question}"></p>
        <label>
          <span>Your Answer:</span>
          <input type="text" class="answer-input" data-type="text" />
        </label>
      </div>

      <!-- Fallback -->
      <div th:case="*">
        <p>Unsupported question type.</p>
      </div>
    </div>

    <!-- ONE final answer string -->
    <input type="hidden" name="userAnswer" id="userAnswer" />

    <br />
    <button type="submit">Check Answer</button>
  </form>

  <form th:action="@{|/quiz/startQuiz/${quiz.id}|}" method="get" style="display:inline;">
    <button type="submit">End Practice Now</button>
  </form>
</div>

<script>
  document.getElementById("quizForm").addEventListener("submit", function (e) {
    const answerInputs = document.querySelectorAll(".answer-input");
    const answers = [];

    answerInputs.forEach(input => {
      const type = input.dataset.type;

      if (type === "checkbox" && input.checked) {
        answers.push(input.value);
      }

      if (type === "text" && input.value.trim() !== "") {
        answers.push(input.value.trim());
      }

      if (type === "select" && input.value !== "") {
        answers.push(input.value);
      }
    });

    document.getElementById("userAnswer").value = answers.join(",");
  });
</script>
</body>
</html>
